---
import Base from "../../layouts/base.astro";
import PageTitle from "../../components/page_title.astro";
import BlogPost from "../../components/blog_post.astro";
import BlogGrid from "../../components/blog_grid.astro";

export async function getStaticPaths() {
  const allPosts = await Astro.glob("../../content/posts/*.md");

  const uniqueTags = [...new Set(allPosts.map((post) => post.frontmatter.tags).flat())];

  return uniqueTags.map((tag) => {
    const filteredPosts = allPosts.filter((post) => post.frontmatter.tags.includes(tag));
    return {
      params: { tag },
      props: { posts: filteredPosts },
    };
  });
}

const { tag } = Astro.params;
const { posts } = Astro.props;
---

<Base title={tag}>
  <PageTitle title={`Tag: ${tag}`} />
  <p>Posts tagged with {tag}</p>
  <!-- List all blogs -->
  <div class="grow">
    <BlogGrid>
      {posts.map((post) => <BlogPost url={post.slug} title={post.frontmatter.title} />)}
    </BlogGrid>
  </div>
</Base>
